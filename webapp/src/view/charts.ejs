<!DOCTYPE html>
<html lang="de">
  <head>
    <% include ./head %>    
    <!-- HTML2Canvas -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js'></script>
    <!-- pdfMake -->
    <script src="/view/assets/pdfmake/pdfmake.js" ></script>
    <script src="/view/assets/pdfmake/vfs_fonts.js" ></script>
    <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.20/pdfmake.min.js'></script>-->
    <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.20/vfs_fonts.js'></script>-->
    <script src="/view/assets/js/report.js"></script>
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <body>
    <% include ./header %>    
    
    <!-- End of Header -->
    <!-- Section for the pdf-report-button and dropdown -->
    <section id="reports">
      <div class="container">
        <div class="row">
          <!-- DropDown Button -->
          <div class="col-xs-6 col-sm-6 col-md-6 text-left">
            <div class="btn-group">
              <button type="button" class="btn btn-red dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Zeitraum
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">letzten 3 Tage</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">letzte Woche</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">letzter Monat</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">bel. Zeitraum</a>
              </div>
              <!-- End of dropdown-menu -->
            </div>
            <!-- End of btn-group -->
          </div>
          <!-- Button fuer den PDF-Report -->
          <div class="col-xs-6 col-sm-6 col-md-6 text-right">
            <button type="submit" class="btn btn-red" id="download-report">PDF Report erstellen</button>
          </div>
        </div>
        <!-- End of Row -->
      </div>
      <!-- End of Container -->
    </section>
    <!-- Section for data tables from chart.js -->
    <section id="tables">
      <div class="container">
        <div class="row">
          <!-- First Chart with number of downloads from all HPi-Courses -->
          <div class="col-xs-12 col-sm-12 col-md-12 charts">
            <div class="chart1" id="chart1">
              <canvas id="myChart"></canvas>
              <script>
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        dataToChart(JSON.parse(this.responseText));
                    }
                };
                xhttp.open("GET", "http://localhost:8080/combinedVisitsPerDay?fields=download", true);
                xhttp.send();
                
                function dataToChart(responseData) {
                    var labels = []; var downloads = [];
                    responseData.forEach(item => {
                        labels.push(item.date); downloads.push(item.sum);
                    });
                    var ctx = document.getElementById("myChart").getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                            data: downloads
                        }]
                        },
                        options: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Gesamtdownloads',
                            fontSize: 32
                        },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    min: 0,
                                    max: 2000,
                                    stepSize: 100
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Downloads',
                                    fontSize: 24
                                }
                            }],
                            xAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Datum',
                                    fontSize: 24
                              }
                            }]
                        }
                    }
                });
                }
              </script>
            </div>
            <!-- Second Chart with number of downloads for top 5 HPI-Courses -->
            <div class="chart2" id="chart2">
              <canvas id="myChart2"></canvas>
              <script>
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        dataToChart2(JSON.parse(this.responseText));
                    }
                };
                xhttp.open("GET", "http://localhost:8080/maxInteractionsInInterval?fields=download&limit=10", true);
                xhttp.send();
                
                function dataToChart2(responseData) {
                    var labels = []; var downloads = [];
                    responseData.forEach(item => {
                        labels.push(item.title.substring(0, 10)); downloads.push(item.sum);
                    });
                var ctx = document.getElementById("myChart2").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: downloads,
                        }]
                    },
                    options: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: true,
                            text: 'Downloadanzahl der HPI-Kurse',
                            fontSize: 32
                        },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    stepSize: 200
                                }, 
                                scaleLabel: {
                                            display: true,
                                            labelString: 'Anzahl Gesamtdownloads',
                                            fontSize: 24
                                        }
                                    }],
                                    xAxes: [{
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Namen der Kurse',
                                            fontSize: 24
                                      }
                                    }]
                                }
                            }
                        });
            }
                        
              </script>
            </div>
            <!-- Third Chart with number of downloads in a certain period -->
            <!-- Course search -->
            <div class="input-group my-group">
              <select id="kurs" class="selectpicker form-control" data-live-search="true" title="Bitte wählen Sie einen Kurs aus ...">
                <option>Kurs_1</option>
                <option>Kurs_2</option>
                <option>Kurs_3</option>
              </select>
              <span class="input-group-btn">
              <button class="btn btn-default" type="submit">LOS!</button></span>
            </div>
            <!-- Course search END -->
            <!-- Third chart -->
            <div class="chart3" id="chart3">
              <canvas id="myChart3"></canvas>
              <script>
                var ctx = document.getElementById("myChart3").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ["Datum_1", "Datum_2", "Datum_3", "Datum_4", "Datum_5", "Datum_6"],
                        datasets: [{
                            data: [12, 19, 3, 5, 2, 3]
                        }]
                    },
                    options: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: true,
                            text: 'Anzahl an Downloads in einem bestimmten Zeitraum',
                            fontSize: 32
                        },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    min: 0,
                                    max: 100,
                                    stepSize: 25
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Azahl Gesamtdownloads für den gewählten Kurs',
                                    fontSize: 24
                                }
                            }],
                            xAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Zeitraum',
                                    fontSize: 24
                              }
                            }]
                        }
                    }
                });
              </script>
            </div>
          </div>
        </div>
        <!-- End of row -->
      </div>
      <!-- End of Container -->
    </section>
    <!-- End of Section with Charts -->
    
    <% include ./footer %>
    
    <!-- Einbinden des JS fuer den Report erstellen -->
    <!-- Muss am Ende des Bodys stehen, sonst kein Download moeglich -->
    <script src="/view/assets/js/report.js"></script>
  </body>
</html>
